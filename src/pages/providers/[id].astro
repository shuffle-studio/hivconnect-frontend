---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Header from '../../components/ui/Header.astro';
import Footer from '../../components/ui/Footer.astro';
import { fetchProviders, fetchProviderBySlug } from '../../lib/api';
import type { Provider } from '../../types/provider';

export async function getStaticPaths() {
  // Fetch all providers from API for static generation
  const providers = await fetchProviders();

  return providers.map((provider) => ({
    params: { id: provider.id },
    props: { provider },
  }));
}

interface Props {
  provider: Provider;
}

const { provider } = Astro.props;

// Map provider IDs to their logo images
const providerLogos: { [key: string]: string } = {
  'eric-chandler-health-center': '/HIV Treatment Website/EBChandler.png',
  'rwj-aids-program': '/HIV Treatment Website/RWJ Medical School Rutgers.png',
  'somerset-treatment-services': '/HIV Treatment Website/Somerset Treatment Services Logo.png',
  'hyacinth-aids-foundation': '/HIV Treatment Website/Hyacinth AIDS Foundation Logo.png',
  'zufall-health': '/HIV Treatment Website/Zufall Health Logo.png',
  'nbcc': '/HIV Treatment Website/New Brunswick Counseling Center Logo.png',
  'raritan-bay-medical-center': '/HIV Treatment Website/HMH-RaritanBay.png',
  'vnahg': '/HIV Treatment Website/VNA Health Group of NJ.png',
  'central-jersey-legal-services': '/HIV Treatment Website/CJLS Logo.png',
  'elijahs-promise': '/HIV Treatment Website/Elijah\'s Promise Logo.png',
  'legal-services-nwj-hunterdon': '/HIV Treatment Website/lsnwj logo.png',
  'legal-services-nwj-somerset': '/HIV Treatment Website/lsnwj logo.png',
  'mcat-transportation': '/HIV Treatment Website/Middlesex County Area Transit.png',
  'zufall-mobile-unit': '/HIV Treatment Website/Zufall Health Logo.png',
  'cvs-pharmacy': '/HIV Treatment Website/cvs-minuteclinic-logo_0.png',
  'planned-parenthood-nj': '/HIV Treatment Website/planned-parenthood-horizontal.svg',
  'woodbridge-health-dept': '/HIV Treatment Website/Woodbridge Health Department Logo.png'
};

const logo = providerLogos[provider.id] || '/HIV Treatment Website/MSHTGA Logo.png';
const location = provider.locations[0];

// Service categories for display
const medicalServices = Object.entries(provider.services.medical_care)
  .filter(([_, value]) => value === true || (Array.isArray(value) && value.length > 0))
  .map(([key, value]) => ({ key, value }));

const supportServices = Object.entries(provider.services.support_services)
  .filter(([_, value]) => value === true)
  .map(([key, _]) => key);

const preventionServices = Object.entries(provider.services.prevention)
  .filter(([_, value]) => value === true)
  .map(([key, _]) => key);

// Enhanced service descriptions for better user understanding
const serviceDescriptions: { [key: string]: string } = {
  'hiv_treatment': 'Comprehensive HIV medical care including antiretroviral therapy (ART) and monitoring',
  'prep_services': 'Pre-Exposure Prophylaxis (PrEP) consultation, prescribing, and monitoring',
  'std_testing': 'Testing for sexually transmitted infections and diseases',
  'dental_care': 'Oral health services and dental care',
  'mental_health_medical': 'Mental health services provided by medical professionals',
  'case_management': 'Personalized care coordination and support navigation',
  'mental_health': 'Counseling, therapy, and mental health support services',
  'substance_abuse': 'Substance use disorder treatment and recovery support',
  'housing_assistance': 'Help finding and maintaining stable housing',
  'transportation': 'Transportation assistance for medical appointments',
  'food_nutrition': 'Food assistance and nutritional support programs',
  'legal_services': 'Legal aid and advocacy services',
  'insurance_help': 'Insurance enrollment and benefits navigation',
  'hiv_testing': 'Confidential HIV testing with rapid and standard options',
  'counseling': 'Pre and post-test counseling and support',
  'prep_counseling': 'Education and counseling about PrEP prevention',
  'education': 'HIV prevention and health education programs',
  'risk_reduction': 'Risk reduction counseling and harm reduction services'
};

// Service icons for better visual presentation
const serviceIcons: { [key: string]: string } = {
  'hiv_treatment': 'M19.5 12c0-1.232-.046-2.453-.138-3.662a4.006 4.006 0 00-3.7-3.7 48.678 48.678 0 00-7.324 0 4.006 4.006 0 00-3.7 3.7c-.017.22-.032.441-.046.662M19.5 12l3-3m-3 3l-3-3m-12 3c0 1.232.046 2.453.138 3.662a4.006 4.006 0 003.7 3.7 48.656 48.656 0 007.324 0 4.006 4.006 0 003.7-3.7c.017-.22.032-.441.046-.662M4.5 12l3 3m-3-3l-3 3',
  'prep_services': 'M9.75 3.104v5.714a2.25 2.25 0 01-.659 1.591L5 14.5M9.75 3.104c-.251.023-.501.05-.75.082m.75-.082a24.301 24.301 0 014.5 0m0 0v5.714c0 .597.237 1.17.659 1.591L19.8 15.3M14.25 3.104c.251.023.501.05.75.082M19.8 15.3l-1.57.393A9.065 9.065 0 0112 15a9.065 9.065 0 00-6.23-.693L5 14.5m14.8.8l1.402 1.402c1.232 1.232.65 3.318-1.067 3.611A48.309 48.309 0 0112 21c-2.773 0-5.491-.235-8.135-.687-1.718-.293-2.3-2.379-1.067-3.611L5 14.5',
  'std_testing': 'M11.35 3.836c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75 2.25 2.25 0 00-.1-.664m-5.8 0A2.251 2.251 0 0113.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m0 0H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h14.25c.621 0 1.125-.504 1.125-1.125V9.375c0-.621-.504-1.125-1.125-1.125H16.5m-8.25 0V6.108c0-1.135.845-2.098 1.976-2.192.373-.03.747-.057 1.124-.08M15.75 18l-3-3m0 0l-3 3m3-3v9',
  'case_management': 'M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z',
  'mental_health': 'M15.182 15.182a4.5 4.5 0 01-6.364 0M21 12a9 9 0 11-18 0 9 9 0 0118 0zM9.75 9.75c0 .414-.168.75-.375.75S9 10.164 9 9.75 9.168 9 9.375 9s.375.336.375.75zm-.375 0h.008v.015h-.008V9.75zm5.625 0c0 .414-.168.75-.375.75s-.375-.336-.375-.75.168-.75.375-.75.375.336.375.75zm-.375 0h.008v.015h-.008V9.75z',
  'housing_assistance': 'M2.25 12l8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25',
  'transportation': 'M8.25 18.75a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m3 0h6m-9 0H3.375a1.125 1.125 0 01-1.125-1.125V14.25m-1.5 18.75v-7.5A1.125 1.125 0 013.375 6h1.5m0 9.75v-4.5m0 4.5h9m0-9V9.375a1.125 1.125 0 011.125-1.125H16.5m0 0h.75c.621 0 1.125.504 1.125 1.125v.75M8.25 12l4.875-4.875L18 12m-8.25 6.75h6.75m-6.75 0v6.75',
  'hiv_testing': 'M9.75 3.104v5.714a2.25 2.25 0 01-.659 1.591L5 14.5M9.75 3.104c-.251.023-.501.05-.75.082m.75-.082a24.301 24.301 0 014.5 0m0 0v5.714c0 .597.237 1.17.659 1.591L19.8 15.3M14.25 3.104c.251.023.501.05.75.082M19.8 15.3l-1.57.393A9.065 9.065 0 0112 15a9.065 9.065 0 00-6.23-.693L5 14.5',
  'counseling': 'M20.25 8.511c.884.284 1.5 1.128 1.5 2.097v4.286c0 1.136-.847 2.1-1.98 2.193-.34.027-.68.052-1.02.072v3.091l-3-3c-1.354 0-2.694-.055-4.02-.163a2.115 2.115 0 01-.825-.242m9.345-8.334a2.126 2.126 0 00-.476-.095 48.64 48.64 0 00-8.048 0c-1.131.094-1.976 1.057-1.976 2.192v4.286c0 .837.46 1.58 1.155 1.951m9.345-8.334V6.637c0-1.621-1.152-3.026-2.76-3.235A48.455 48.455 0 0011.25 3c-2.115 0-4.198.137-6.24.402-1.608.209-2.76 1.614-2.76 3.235v6.226c0 1.621 1.152 3.026 2.76 3.235.577.075 1.157.14 1.74.194V21l4.155-4.155'
};

// Format service names for display
const formatServiceName = (serviceName: string): string => {
  return serviceName
    .split('_')
    .map(word => word.charAt(0).toUpperCase() + word.slice(1))
    .join(' ');
};

// Format hours for display
const formatHours = (hours: any) => {
  const daysOfWeek = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];
  const dayNames = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
  
  return daysOfWeek.map((day, index) => {
    const dayHours = hours[day];
    if (!dayHours) return `${dayNames[index]}: Closed`;
    return `${dayNames[index]}: ${dayHours.open} - ${dayHours.close}`;
  });
};

const title = `${provider.name} - HIV Care Provider`;
const description = provider.description || `Comprehensive HIV care and support services at ${provider.name} in ${location.city}, ${location.county} County, New Jersey.`;
---

<BaseLayout title={title} description={description}>
  <Header />
  
  <main id="main-content" class="flex-1">
    <!-- Provider Header -->
    <section class="bg-gradient-to-br from-primary-50 to-secondary-50 py-12">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="max-w-4xl mx-auto">
          <!-- Breadcrumb -->
          <nav class="mb-6" aria-label="Breadcrumb">
            <ol class="flex items-center space-x-2 text-sm text-gray-600">
              <li><a href="/" class="hover:text-primary-600">Home</a></li>
              <li><span class="mx-2">/</span></li>
              <li><a href="/find-services" class="hover:text-primary-600">Find Services</a></li>
              <li><span class="mx-2">/</span></li>
              <li class="text-gray-900 font-medium">{provider.name}</li>
            </ol>
          </nav>

          <div class="bg-white rounded-lg shadow-lg p-8">
            <div class="flex flex-col lg:flex-row items-start lg:items-center space-y-6 lg:space-y-0 lg:space-x-8">
              <!-- Provider Logo -->
              <div class="flex-shrink-0">
                <img 
                  src={logo} 
                  alt={`${provider.name} logo`}
                  class="w-24 h-24 lg:w-32 lg:h-32 object-contain rounded-lg bg-gray-50 p-2"
                  loading="lazy"
                />
              </div>

              <!-- Provider Info -->
              <div class="flex-1">
                <div class="flex flex-wrap items-center gap-3 mb-4">
                  <h1 class="text-3xl lg:text-4xl font-bold text-gray-900">{provider.name}</h1>
                  <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-secondary-100 text-secondary-800">
                    {provider.type}
                  </span>
                  {provider.featured && (
                    <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-primary-100 text-primary-800">
                      Featured Provider
                    </span>
                  )}
                </div>

                {provider.description && (
                  <p class="text-lg text-gray-700 mb-4">{provider.description}</p>
                )}

                <!-- Ryan White Parts -->
                {provider.ryan_white_parts.length > 0 && (
                  <div class="mb-4">
                    <span class="text-sm font-medium text-gray-700 mr-2">Ryan White Parts:</span>
                    <div class="inline-flex flex-wrap gap-1">
                      {provider.ryan_white_parts.map(part => (
                        <span class="inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-success-100 text-success-800">
                          Part {part}
                        </span>
                      ))}
                    </div>
                  </div>
                )}

                <!-- Languages -->
                <div class="mb-4">
                  <span class="text-sm font-medium text-gray-700 mr-2">Languages:</span>
                  <span class="text-sm text-gray-600">
                    {provider.languages.map(lang => lang.charAt(0).toUpperCase() + lang.slice(1)).join(', ')}
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Contact & Location Info -->
    <section class="py-12 bg-white">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
          <!-- Contact Information -->
          <div class="card">
            <h2 class="text-2xl font-bold text-gray-900 mb-6">Contact Information</h2>
            
            <div class="space-y-4">
              <!-- Phone -->
              <div class="flex items-start space-x-3">
                <svg class="w-5 h-5 text-primary-600 mt-1 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
                </svg>
                <div>
                  <p class="font-medium text-gray-900">Phone</p>
                  <a href={`tel:${provider.contact.phone}`} class="text-primary-600 hover:text-primary-700 font-medium">
                    {provider.contact.phone}
                  </a>
                  {provider.contact.phone_24hr && (
                    <p class="text-sm text-gray-600 mt-1">24/7 Line: {provider.contact.phone_24hr}</p>
                  )}
                </div>
              </div>

              <!-- Email -->
              {provider.contact.email && (
                <div class="flex items-start space-x-3">
                  <svg class="w-5 h-5 text-primary-600 mt-1 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                  </svg>
                  <div>
                    <p class="font-medium text-gray-900">Email</p>
                    <a href={`mailto:${provider.contact.email}`} class="text-primary-600 hover:text-primary-700 font-medium">
                      {provider.contact.email}
                    </a>
                  </div>
                </div>
              )}

              <!-- Website -->
              {provider.contact.website && (
                <div class="flex items-start space-x-3">
                  <svg class="w-5 h-5 text-primary-600 mt-1 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9v-9m0-9v9m0 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9" />
                  </svg>
                  <div>
                    <p class="font-medium text-gray-900">Website</p>
                    <a href={provider.contact.website} target="_blank" rel="noopener noreferrer" class="text-primary-600 hover:text-primary-700 font-medium">
                      Visit Website
                    </a>
                  </div>
                </div>
              )}

              <!-- Telehealth -->
              {provider.contact.telehealth_portal && (
                <div class="flex items-start space-x-3">
                  <svg class="w-5 h-5 text-primary-600 mt-1 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                  </svg>
                  <div>
                    <p class="font-medium text-gray-900">Telehealth Available</p>
                    <a href={provider.contact.telehealth_portal} target="_blank" rel="noopener noreferrer" class="text-primary-600 hover:text-primary-700 font-medium">
                      Access Portal
                    </a>
                  </div>
                </div>
              )}
            </div>

            <!-- Quick Actions -->
            <div class="mt-8 space-y-3">
              <a href={`tel:${provider.contact.phone}`} class="btn-primary w-full text-center">
                Call Now
              </a>
              {provider.contact.website && (
                <a href={provider.contact.website} target="_blank" rel="noopener noreferrer" class="btn-outline w-full text-center">
                  Visit Website
                </a>
              )}
            </div>
          </div>

          <!-- Location & Hours -->
          <div class="card">
            <h2 class="text-2xl font-bold text-gray-900 mb-6">Location & Hours</h2>
            
            <!-- Address -->
            <div class="mb-6">
              <div class="flex items-start space-x-3">
                <svg class="w-5 h-5 text-primary-600 mt-1 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                </svg>
                <div>
                  <p class="font-medium text-gray-900">Address</p>
                  <address class="not-italic text-gray-700">
                    {location.address}<br/>
                    {location.city}, {location.county.charAt(0).toUpperCase() + location.county.slice(1)} County, NJ {location.zip_code}
                  </address>
                  <div class="mt-2">
                    <a 
                      href={`https://maps.google.com/maps?daddr=${location.coordinates.lat},${location.coordinates.lng}`}
                      target="_blank" 
                      rel="noopener noreferrer"
                      class="text-primary-600 hover:text-primary-700 font-medium text-sm"
                    >
                      Get Directions â†’
                    </a>
                  </div>
                </div>
              </div>
            </div>

            <!-- Hours -->
            <div class="mb-6">
              <h3 class="font-medium text-gray-900 mb-3">Hours of Operation</h3>
              <div class="space-y-1 text-sm">
                {formatHours(location.hours).map(hourString => (
                  <p class="text-gray-700">{hourString}</p>
                ))}
              </div>
              {location.emergency_hours && (
                <p class="text-sm text-primary-600 font-medium mt-2">{location.emergency_hours}</p>
              )}
            </div>

            <!-- Accessibility -->
            {location.accessibility.length > 0 && (
              <div>
                <h3 class="font-medium text-gray-900 mb-3">Accessibility Features</h3>
                <div class="flex flex-wrap gap-2">
                  {location.accessibility.map(feature => (
                    <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-success-100 text-success-800">
                      {feature.replace('_', ' ').replace(/\b\w/g, l => l.toUpperCase())}
                    </span>
                  ))}
                </div>
              </div>
            )}
          </div>
        </div>
      </div>
    </section>

    <!-- Services Offered -->
    <section class="py-16 bg-gray-50">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center mb-12">
          <h2 class="text-3xl font-bold text-gray-900 mb-4">Complete Services Available</h2>
          <p class="text-lg text-gray-600 max-w-3xl mx-auto">
            {provider.name} provides comprehensive HIV care and support services. All services are confidential and many are available regardless of insurance status.
          </p>
        </div>
        
        <!-- Featured Services Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-12">
          <!-- Medical Care -->
          {medicalServices.length > 0 && (
            <div class="card hover:shadow-lg transition-shadow duration-300">
              <div class="w-12 h-12 bg-primary-100 rounded-lg flex items-center justify-center mb-4">
                <svg class="w-6 h-6 text-primary-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                </svg>
              </div>
              <h3 class="text-xl font-semibold text-gray-900 mb-4">Medical Care & Treatment</h3>
              <div class="space-y-3">
                {medicalServices.map(({ key, value }) => (
                  <div class="p-3 bg-white rounded-lg border-l-4 border-primary-500">
                    <div class="flex items-start space-x-3">
                      <svg class="w-5 h-5 text-primary-600 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d={serviceIcons[key] || 'M5 13l4 4L19 7'} />
                      </svg>
                      <div class="flex-1">
                        <p class="font-medium text-gray-900 text-sm">{formatServiceName(key)}</p>
                        <p class="text-xs text-gray-600 mt-1">{serviceDescriptions[key] || ''}</p>
                        {Array.isArray(value) && value.length > 0 && (
                          <div class="mt-2 flex flex-wrap gap-1">
                            {value.map(specialty => (
                              <span class="inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-primary-100 text-primary-800">
                                {formatServiceName(specialty)}
                              </span>
                            ))}
                          </div>
                        )}
                      </div>
                    </div>
                  </div>
                ))}
              </div>
            </div>
          )}

          <!-- Support Services -->
          {supportServices.length > 0 && (
            <div class="card hover:shadow-lg transition-shadow duration-300">
              <div class="w-12 h-12 bg-secondary-100 rounded-lg flex items-center justify-center mb-4">
                <svg class="w-6 h-6 text-secondary-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                </svg>
              </div>
              <h3 class="text-xl font-semibold text-gray-900 mb-4">Support Services</h3>
              <div class="space-y-3">
                {supportServices.map(service => (
                  <div class="p-3 bg-white rounded-lg border-l-4 border-secondary-500">
                    <div class="flex items-start space-x-3">
                      <svg class="w-5 h-5 text-secondary-600 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d={serviceIcons[service] || 'M5 13l4 4L19 7'} />
                      </svg>
                      <div class="flex-1">
                        <p class="font-medium text-gray-900 text-sm">{formatServiceName(service)}</p>
                        <p class="text-xs text-gray-600 mt-1">{serviceDescriptions[service] || ''}</p>
                      </div>
                    </div>
                  </div>
                ))}
              </div>
            </div>
          )}

          <!-- Prevention Services -->
          {preventionServices.length > 0 && (
            <div class="card hover:shadow-lg transition-shadow duration-300">
              <div class="w-12 h-12 bg-success-100 rounded-lg flex items-center justify-center mb-4">
                <svg class="w-6 h-6 text-success-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                </svg>
              </div>
              <h3 class="text-xl font-semibold text-gray-900 mb-4">Testing & Prevention</h3>
              <div class="space-y-3">
                {preventionServices.map(service => (
                  <div class="p-3 bg-white rounded-lg border-l-4 border-success-500">
                    <div class="flex items-start space-x-3">
                      <svg class="w-5 h-5 text-success-600 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d={serviceIcons[service] || 'M5 13l4 4L19 7'} />
                      </svg>
                      <div class="flex-1">
                        <p class="font-medium text-gray-900 text-sm">{formatServiceName(service)}</p>
                        <p class="text-xs text-gray-600 mt-1">{serviceDescriptions[service] || ''}</p>
                      </div>
                    </div>
                  </div>
                ))}
              </div>
            </div>
          )}
        </div>

        <!-- Additional Provider Info -->
        <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
          <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Ryan White Parts -->
            <div class="text-center">
              <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center mx-auto mb-3">
                <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
              </div>
              <h4 class="font-semibold text-gray-900 mb-2">Ryan White Funded</h4>
              <div class="flex justify-center space-x-2">
                {provider.ryan_white_parts.map(part => (
                  <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                    Part {part}
                  </span>
                ))}
              </div>
            </div>

            <!-- Languages -->
            <div class="text-center">
              <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center mx-auto mb-3">
                <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5h12M9 3v2m1.048 9.5A18.022 18.022 0 016.412 9m6.088 9h7M11 21l5-10 5 10M12.751 5C11.783 10.77 8.07 15.61 3 18.129" />
                </svg>
              </div>
              <h4 class="font-semibold text-gray-900 mb-2">Languages Spoken</h4>
              <div class="flex justify-center flex-wrap gap-2">
                {provider.languages.map(lang => (
                  <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">
                    {lang.charAt(0).toUpperCase() + lang.slice(1)}
                  </span>
                ))}
              </div>
            </div>

            <!-- Special Populations -->
            <div class="text-center">
              <div class="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center mx-auto mb-3">
                <svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z" />
                </svg>
              </div>
              <h4 class="font-semibold text-gray-900 mb-2">Specialized Care For</h4>
              <div class="flex justify-center flex-wrap gap-2">
                {provider.eligibility.special_populations.map(pop => (
                  <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-purple-100 text-purple-800">
                    {pop.toUpperCase()}
                  </span>
                ))}
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Eligibility & Insurance -->
    <section class="py-12 bg-white">
      <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
        <h2 class="text-3xl font-bold text-gray-900 mb-8 text-center">Eligibility & Insurance</h2>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
          <!-- Insurance Accepted -->
          <div class="card">
            <h3 class="text-xl font-semibold text-gray-900 mb-4">Insurance Accepted</h3>
            <div class="flex flex-wrap gap-2">
              {provider.eligibility.insurance_accepted.map(insurance => (
                <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-secondary-100 text-secondary-800">
                  {insurance.charAt(0).toUpperCase() + insurance.slice(1)}
                </span>
              ))}
            </div>
            {provider.eligibility.income_requirements && (
              <p class="mt-4 text-sm text-gray-600">
                <strong>Income Requirements:</strong> Up to {provider.eligibility.income_requirements.replace('up_to_', '').replace('_fpl', '% of Federal Poverty Level')}
              </p>
            )}
          </div>

          <!-- Special Populations -->
          {provider.eligibility.special_populations.length > 0 && (
            <div class="card">
              <h3 class="text-xl font-semibold text-gray-900 mb-4">Special Populations Served</h3>
              <div class="flex flex-wrap gap-2">
                {provider.eligibility.special_populations.map(population => (
                  <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-success-100 text-success-800">
                    {formatServiceName(population)}
                  </span>
                ))}
              </div>
            </div>
          )}
        </div>

        <!-- Important Notice -->
        <div class="mt-8 bg-primary-50 border border-primary-200 rounded-lg p-6">
          <div class="flex items-start space-x-3">
            <svg class="w-6 h-6 text-primary-600 flex-shrink-0 mt-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            <div>
              <h4 class="text-lg font-semibold text-primary-900 mb-2">Your Privacy Matters</h4>
              <p class="text-primary-800">
                All HIV-related services are strictly confidential. Your information is protected by federal and state privacy laws. 
                Immigration status does not affect your ability to receive care. Quality HIV care shouldn't depend on your ability to pay.
              </p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Call to Action -->
    <section class="py-12 bg-gradient-to-br from-primary-50 to-secondary-50">
      <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
        <h2 class="text-3xl font-bold text-gray-900 mb-4">Ready to Get Started?</h2>
        <p class="text-xl text-gray-700 mb-8">
          Contact {provider.name} today to learn more about their services or schedule an appointment.
        </p>
        
        <div class="flex flex-col sm:flex-row justify-center gap-4">
          <a href={`tel:${provider.contact.phone}`} class="btn-primary text-lg px-8 py-4">
            Call {provider.contact.phone}
          </a>
          <a href="/find-services" class="btn-outline text-lg px-8 py-4">
            Find Other Providers
          </a>
        </div>

        <!-- Emergency Support -->
        <div class="mt-8 p-4 bg-white rounded-lg shadow-md">
          <h3 class="text-lg font-semibold text-gray-900 mb-2">Need Help Right Now?</h3>
          <div class="flex flex-col sm:flex-row justify-center gap-3">
            <a href="tel:988" class="emergency-button text-sm">Crisis: 988</a>
            <a href="tel:18004484663" class="btn-primary text-sm">HIV Hotline: 1-800-HIV-INFO</a>
          </div>
        </div>
      </div>
    </section>
  </main>
  
  <Footer />
</BaseLayout>